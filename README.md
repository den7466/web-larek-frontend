# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс карточки

```js
export interface ICard {
	id: string;
	description?: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Интерфейс заказа

```js
export interface IOrder {
  payment: TPayment;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}
```

Тип данных способа оплаты

```js
export type TPayment = 'receipt' | 'online';
```

Интерфейс модели данных заказа

```js
export interface IOrderModel {
  order: IOrder;
	clearOrder: () => void;
}
```

Интерфейс модели данных карточек

```js
export interface IStoreModel {
	cards: ICard[];
	getCard: (id: string) => ICard;
}
```

Интерфейс модели данных корзины

```js
export interface IBasketModel {
	cardsInBasket: ICard[];
	total: number;
	existsInBasket: (id: string) => boolean;
	addToBasket: (card: ICard) => void;
	removeFromBasket: (id: string) => void;
	clearBasket: () => void;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой данных, отвечает за хранение и изменение данных;
- слой представления, отвечает за отображение данных на странице;
- слой коммуникации, отвечает за связь представления и данных.

### Базовый код

#### Класс EventEmitter
Класс `EventEmitter` реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Конструктор класса не принимает параметров.

Поля класса:
- `_events: Map<EventName, Set<Subscriber>>` - события.

Методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on<T extends object>(eventName: EventName, callback: (event: T) => void): void` - подписаться на событие;
- `off(eventName: EventName, callback: Subscriber): void` - отписаться от события;
- `emit<T extends object>(eventName: string, data?: T): void` - инициализировать событие.

Дополнительно реализованы методы:
- `onAll(callback: (event: EmitterEvent) => void): void` - подписаться на все события;
- `offAll(): void` - отписаться от всех событий;
- `trigger<T extends object>(eventName: string, context?: Partial<T>): (data: T) => void` - сгенерировать заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

#### Класс Api
Класс `Api` реализует базовую логику отправки запросов на сервер с данными.

Конструктор класса принимает базовый адрес сервера и опционально объект с заголовками запросов.

Методы, реализуемые классом:
- `get(uri: string): Promise<object>` - выполняет `GET` запрос на ендпоинт, принимает один параметр - ендпоинт и возвращает ответ от сервера в виде промиса с объектом;
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - выполняет `POST` запрос на эндпоинт, принимает три параметра: ендпоинт, объект с данными, метод запроса(по умолчанию - `POST`) и возвращает ответ от сервера в виде промиса с объектом.

### Слой данных

#### Класс StoreModel
Класс `StoreModel`, описан интерфейсом `IStoreModel`, реализует хранение и логику работы с данными карточек.

Конструктор класса не принимает параметров.

Поля класса:
- `_cards: ICard[]` - массив объектов карточек.

Методы, реализуемые классом:
- `getCard(id: string): ICard` - параметром принимает id карточки и возвращает карточку соответствующую переданному id.

#### Класс BasketModel
Класс `BasketModel`, описан интерфейсом `IBasketModel`, реализует хранение и логику работы с данными корзины.

Конструктор класса не принимает параметров.

Поля класса:
- `_cardsInBasket: ICard[]` - массив объектов карточек;
- `_total: number` - итоговая сумма.

Методы, реализуемые классом:
- `existsInBasket(id: string): boolean` - параметром принимает id карточки, если карточка в корзине уже есть, возвращает ответ типа `boolean`;
- `addToBasket(card: ICard): void` - параметром принимает объект карточки, добавляет карточку в массив `_cardsInBasket`;
- `removeFromBasket(id: string): void` - параметром принимает id карточки, удаляет карточку из массива `_cardsInBasket` соответствующую переданному id;
- `clearBasket(): void` - очищает массив `_cardsInBasket`, и свойство `_total`.

#### Класс OrderModel
Класс `OrderModel`, описан интерфейсом `IOrderModel`, реализует хранение и логику работы с данными заказа.

Конструктор класса не принимает параметров.

Поля класса:
- `_order: IOrder` - объект заказа.

Методы, реализуемые классом:
- `clearOrder(): void` - очищает поля объекта `_order`.

### Слой представления

#### Класс Basket
Класс `Basket` расширяет класс `EventEmitter`, описан интерфейсом `IBasket`, реализует отображение блока корзины заказов.

Конструктор класса принимает один параметр: `template` - шаблон разметки блока.

Поля класса:
- `_total: HTMLElement` - элемент с итоговой ценой;
- `_container: HTMLElement` - элемент с итоговой разметкой корзины заказов;
- `_basketList: HTMLElement` - элемент отображения списка карточек в корзине заказов;
- `_buttonCheckout: HTMLButtonElement` - элемент кнопки оформления заказа.

Методы, реализуемые классом:
- `render(list: HTMLElement[]): HTMLElement` - параметром принимает массив карточек, возвращает готовый элемент корзины со списком карточек.

#### Класс Card
Класс `Card`, расширяет класс `EventEmitter`, описан интерфейсом `IViewCardGallery`, реализует отображение карточки товара.

Конструктор класса принимает один параметр: `template` - шаблон разметки блока.

Поля класса:
- `_cardElement: HTMLElement` - элемент карточки с разметкой;
- `_id: string` - id карточки;
- `_image: HTMLImageElement` - элемент изображения карточки товара;
- `_title: HTMLElement` - элемент наименования карточки товара;
- `_category: HTMLElement` - элемент категории карточки товара;
- `_price: HTMLElement` - элемент цены карточки товара.

Методы, реализуемые классом:
- `render(card: ICard): HTMLElement` - параметром принимает данные карточки товара, возвращает готовую карточку с данными.

#### Класс CardBasket
Класс `CardBasket`, расширяет класс `Card`, описан интерфейсом `ICardBasket`, реализует отображение карточки товара в корзине заказов.

Конструктор класса принимает один параметр: `template` - шаблон разметки блока.

Поля класса:
- `_index: HTMLElement` - элемент идентификатора карточки;
- `_buttonDeleteFromBasket: HTMLButtonElement` - элемент кнопки удаления товара из корзины.

Методы, реализуемые классом:
- `render(card: ICard): HTMLElement` - параметром принимает данные карточки товара, возвращает готовую карточку с данными.

#### Класс CardFull
Класс `CardFull`, расширяет класс `Card`, описан интерфейсом `IViewCardFull`, реализует отображение полной карточки.

Конструктор класса принимает один параметр: `template` - шаблон разметки блока.

Поля класса:
- `_description: HTMLElement` - элемент с описание товара;
- `_buttonAddToBasket: HTMLButtonElement` - элемент кнопки добавления в корзину товаров.

Методы, реализуемые классом:
- `disableAddButton(): void` - отключает кнопку добавления в корзину товара;
- `render(card: ICard): HTMLElement` - параметром принимает данные карточки товара, возвращает готовую карточку с полными данными.

#### Класс Modal
Класс `Modal`, описан интерфейсом `IModal`, реализует отображение модального окна.

Конструктор класса принимает два параметра: container - контейнер модального окна, pageWrapper - главный блок всей страницы.

Поля класса:
- `_closeButton: HTMLButtonElement` - элемент кнопки закрытия;
- `_content: HTMLElement` - элемент контента;
- `_pageWrapper: HTMLElement` - элемент главного блока станицы.

Методы, реализуемые классом:
- `open(): void` - открывает модальное окно;
- `close(): void` - закрывает модальное окно.

#### Класс OrderContact
Класс `OrderContact`, расширяет класс `EventEmitter`, описан интерфейсом `IOrderContact`, реализует отображение формы с добавлением контактных данных.

Конструктор класса принимает один параметр: `template` - шаблон разметки блока.

Поля класса:
- `_container: HTMLElement` - элемент с итоговой разметкой формы;
- `_email: HTMLInputElement` - элемент поля ввода email;
- `_phone: HTMLInputElement` - элемент поля ввода phone;
- `_orderButton: HTMLButtonElement` - элемент кнопки оформления заказа.

Методы, реализуемые классом:
- `render(): HTMLElement` - не принимает параметров, возвращает готовый элемент формы.

#### Класс OrderPayment
Класс `OrderPayment`, расширяет класс `EventEmitter`, описан интерфейсом `IOrderPayment`, реализует отображение формы с добавлением адреса и выбора метода оплаты.

Конструктор класса принимает один параметр: `template` - шаблон разметки блока.

Поля класса:
- `_payment: TPayment` - способ оплаты;
- `_container: HTMLElement` - элемент с итоговой разметкой формы;
- `_address: HTMLInputElement` - элемент поля ввода адреса;
- `_onlinePaymentButton: HTMLButtonElement` - элемент кнопки выбора метода платежа "Онлайн";
- `_receiptPaymentButton: HTMLButtonElement` - элемент кнопки выбора метода платежа "При получении";
- `_orderButton: HTMLButtonElement` - элемент кнопки оформления заказа.

Методы, реализуемые классом:
- `render(): HTMLElement` - не принимает параметров, возвращает готовый элемент формы.

#### Класс OrderSuccess
Класс `OrderSuccess`, расширяет класс `EventEmitter`, описан интерфейсом `IOrderSuccess`, реализует отображение информации об успешном оформлении заказа.

Конструктор класса принимает два параметра: `template` - шаблон разметки блока, total - итоговая цена.

Поля класса:
- `_container: HTMLElement` - элемент с итоговой разметкой блока;
- `_description: HTMLElement` - элемент описания успешного заказа;
- `_bottonSuccessClose: HTMLButtonElement` - элемент кнопки закрытия модального окна.

Методы, реализуемые классом:
- `render(): HTMLElement` - не принимает параметров, возвращает готовый элемент блока успешного заказа.

#### Класс Page
Класс `Page`, расширяет класс `EventEmitter`, описан интерфейсом `IPage`, реализует отображение общих элементов на странице.

Конструктор класса принимает один параметр: _pageContainer - главный блок страницы.

Поля класса:
- `_buttonBasket: HTMLButtonElement` - элемент кнопки корзины заказов;
- `_counterBasket: HTMLElement` - элемент счетчика заказов;
- `_listContainer: HTMLElement` - элемент для отображения списка товаров.

Методы, реализуемые классом - нет.

### Слой коммуникации

#### Класс StoreApi
Класс `StoreApi`, расширяет класс `Api`, описан интерфейсом `IStoreAPI`, реализует взаимодействие с бэкендом сервиса.

Конструктор класса принимает три параметра: cdn - базовый url для изображений, baseUrl - базовый url сервера с данными, options - заголовки, если есть.

Поля класса:
- `cdn: string` - базовый url для изображений.

Методы, реализуемые классом:
- `getCardList(): Promise<ICard[]>` - не принимает параметров, возвращает промис со списком карточек;
- `getCardItem(id: string): Promise<ICard>` - параметром принимает id карточки, возвращает промис с данными карточки, соответствующей переданному id;
- `pushOrder(data: IOrder): Promise<any>` - параметром принимает данные о заказе, передает данные на сервер, возвращает промис с ответом от сервера.

## Взаимодействие компонентов
Взаимодействие между слоем данных и слоем представления происходит в файле `index.ts`, который выполняет роль презентера.\
Данные, принятые с сервера передаются в слой модели данных, там обрабатываются, после чего готовые данные передаются в слой представления, который в свою очередь на основании переданного шаблона формирует готовый элемент с разметкой - отдает его в `index.ts`.\
Все взаимодействия осуществляются за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.